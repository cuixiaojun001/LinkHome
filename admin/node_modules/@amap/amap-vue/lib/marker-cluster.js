"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_virtual/_tslib.js"),r=require("./load-plugins.js"),t=require("vue"),n=require("./mixins/mixins.js"),a=require("./mixins/props.js"),i=require("./mixins/base.js"),s=require("./marker.js"),o=require("./utils/safe-get.js"),u=require("./utils/debounce.js"),d=require("./utils/perf.js");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=l(t),p=s.default.sealedOptions,f=c.default.extend({props:p.props}),m=void 0;function h(e,r,t){var n=e[r];Array.isArray(n)&&(e[r]=new t(n[0],n[1]))}function _(r){return r&&0!==r.length?r.map((function(r){var t=e.__assign({},r);return h(t,"size",AMap.Size),h(t,"offset",AMap.Pixel),h(t,"imageOffset",AMap.Pixel),t})):r}var k=n.default(i.default).extend({name:"AmapMarkerCluster",amapMeta:{prepare:function(){return r.default("AMap.MarkerCluster")},initComponent:function(r,t){return e.__awaiter(this,void 0,void 0,(function(){var n;return e.__generator(this,(function(e){return n=this,this.$scopedSlots.cluster&&(t.renderClusterMarker=n._renderCluster),this.$scopedSlots.marker&&(t.renderMarker=n._renderMarker),[2,new r.MarkerCluster(n.$map,n.data||[],t)]}))}))},events:["click"]},props:{data:a.defineProp({type:Array,required:!0,initialize:!1}),gridSize:a.defineProp("setGridSize",Number),maxZoom:a.defineProp("setMaxZoom",Number),averageCenter:a.defineProp({type:Boolean,default:void 0,setter:"setAverageCenter"}),clusterByZoomChange:{type:Boolean,default:void 0},styles:a.defineProp({type:Array,setter:function(e,r){e.setStyles(_(r))},transform:_}),markerOptions:a.defineProp({type:Function,initialize:!1}),clusterOptions:a.defineProp({type:Function,initialize:!1})},data:function(){return{$mcc:null}},mounted:function(){var e=this,r=u.default(this._onDataChange,100),t=this.$scopedSlots.marker,n=this.$scopedSlots.cluster;this.$context.ready.then((function(){e._onDataChange()}));var a=c.default.extend({props:{point:{type:Object}},render:function(){if(!t)return null;var e=t(this.point);return o.default(e,"0",null)}}),i=c.default.extend({props:{context:{type:Object}},render:function(){if(!n)return null;var e=n(this.context);return o.default(e,"0",null)}});this.$mcc={marker:new a,cluster:new i,dummy:new f},this.$watch("data",{handler:r})},beforeDestroy:function(){this.$mcc.marker.$destroy(),this.$mcc.cluster.$destroy(),this.$mcc.dummy.$destroy()},methods:{_onDataChange:function(){return e.__awaiter(this,void 0,void 0,(function(){var r,t,n;return e.__generator(this,(function(e){switch(e.label){case 0:return t=(r=this).data,[4,(n=r.$context).ready];case 1:return e.sent(),n.destroyed?[2]:(this.$target.setData(t),[2])}}))}))},_renderMarkerContent:function(e,r,t){d.start("MarkerCluster#_renderMarkerContent");var n=function(e,r){m||(m=document.createElement("div"));var t=e;return t._props=r,t._vnode=null,t.$mount(m),t._vnode.elm}(r,t);e.marker.setContent(n),d.stop("MarkerCluster#_renderMarkerContent")},_setMarkerOptions:function(e,r,t){var n={};"function"==typeof r&&Object.assign(n,r(t));for(var i=Object.keys(n),s=this.$mcc.dummy,o=0;o<i.length;++o){var u=i[o],d=n[u],l=p.props[u];void 0!==l&&a.setPropValue(s,e.marker,l,d)}},_renderMarker:function(e){d.start("MarkerCluster#_renderMarker");var r=e.data[0],t={point:r};this._renderMarkerContent(e,this.$mcc.marker,t),this._setMarkerOptions(e,this.markerOptions,r),d.stop("MarkerCluster#_renderMarker")},_renderCluster:function(e){d.start("MarkerCluster#_renderCluster");var r={context:e};this._renderMarkerContent(e,this.$mcc.cluster,r),this._setMarkerOptions(e,this.clusterOptions,e),d.stop("MarkerCluster#_renderCluster")}},render:function(){return null}});exports.default=k;
